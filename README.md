# UDP-Data-Transmission
    用go语言实现监听端口，接收每次随机发送的UDP数据包，并存储到MySQL数据库中(批量存储实现)，用日志记录错误信息。
## 代码提示

在此代码中设置的是每接收10次UDP数据包使用协程存储一次，存储的时候设置的是批量存储，代码中也有每次存储一条的代码，但是在运行的过程中会发现这个存储的速度确实有点慢，可以运行比较下。关于批量存储，就是通过拼接字符串来实现的，我是参考原生SQL来进行修改的，实现的过程中bug挺多的。

在client.go中添加了随机数，通过随机数的设置来改变每次发送的UDP数据包的大小，查看代码的容错性。

发送的数据包是通过python脚本随机生成的。

目前的实现是假设发送的所有数据都是字符串，这些字符串是通过换行符(\n)来分割每一条数据和分隔符(|)分割每一个字段实现的。（目前并没有对发送的数据进行多余的处理，没有判断相应的字段是否合法）

注意代码中管道和协程的使用。创建了三个协程，第一个实现对字符串进行切割，第二个协程实现对上一个协程处理好的数据进行存储。还有的协程，主要是用来记录当前数据表的数据量，写入到日志中（这个协程纯属闲着无聊加的，因为不加日志中没数据，还有个原因就是练习下go语言操作MySQL的实现）。

在代码运行前要先用python脚本生成相应的测试数据。


给的需求是每分钟实现千万级的存储量，目前代码还没有进行更多的测试，不过可以肯定的是，肯定达不到。高并发这一块还需要进一步去处理，不过存储MySQL，个人感觉以我的能力不太可能实现。

接下来需要做的就是把通过接收UDP数据次数来存储修改为通过设置时间来存储。

如果后期有新的需求，代码会继续更新，目前先就这样了。。。。。。


### Version 1 版本
目前有个bug，以目前的设计方案来说，是根据发送的次数来进行控制的，但是最后一次的时候可能发送了不到10次，所以这些数据并不会被存储起来，这里要加一个超时判断，达到一定的时间以后就进行一次数据存储。

如果说有多台机器同时发数据，这个时候通过次数来控制的话并不是一个好的方法。因为每秒可能就会发送超过10次数据，所以这里如果根据次数来控制的话效率有点低。所以要进行控制，改成根据时间进行控制的。

### Version 2 版本
这个是通过设置时间来实现的，但是里面有一个bug，这个目前还没想好要怎么修改。在这份代码中设置了每隔10s存储一次，但是如果说数据在接收了1-9s之后代码卡死在等待UDP发送数据的代码处，那么这些数据并没有被存储起来，只有等到这个再次发送UDP数据的时候才会存储。不过代码设计的本意应该是每达到10s以后就进行存储，这里在写代码的时候并没有想好，导致了后期的难产。
